{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport firebase from 'firebase';\n\nvar Fire = function () {\n  function Fire() {\n    var _this = this;\n\n    _classCallCheck(this, Fire);\n\n    this.init = function () {\n      return firebase.initializeApp({\n        apiKey: 'AIzaSyDLgW8QG1qO8O5WZLC1U8WaqCr5-CvEVmo',\n        authDomain: 'chatter-b85d7.firebaseapp.com',\n        databaseURL: 'https://chatter-b85d7.firebaseio.com',\n        projectId: 'chatter-b85d7',\n        storageBucket: '',\n        messagingSenderId: '861166145757'\n      });\n    };\n\n    this.observeAuth = function () {\n      return firebase.auth().onAuthStateChanged(_this.onAuthStateChanged);\n    };\n\n    this.onAuthStateChanged = function (user) {\n      if (!user) {\n        try {\n          firebase.auth().signInAnonymously();\n        } catch (_ref) {\n          var message = _ref.message;\n          alert(message);\n        }\n      }\n    };\n\n    this.on = function (callback) {\n      return _this.ref.limitToLast(20).on('child_added', function (snapshot) {\n        return callback(_this.parse(snapshot));\n      });\n    };\n\n    this.parse = function (snapshot) {\n      var _snapshot$val = snapshot.val(),\n          numberStamp = _snapshot$val.timestamp,\n          text = _snapshot$val.text,\n          user = _snapshot$val.user;\n\n      var _id = snapshot.key;\n      var timestamp = new Date(numberStamp);\n      var message = {\n        _id: _id,\n        timestamp: timestamp,\n        text: text,\n        user: user\n      };\n      return message;\n    };\n\n    this.send = function (messages) {\n      for (var i = 0; i < messages.length; i++) {\n        var _messages$i = messages[i],\n            text = _messages$i.text,\n            user = _messages$i.user;\n        var message = {\n          text: text,\n          user: user,\n          timestamp: _this.timestamp\n        };\n\n        _this.append(message);\n      }\n    };\n\n    this.append = function (message) {\n      return _this.ref.push(message);\n    };\n\n    this.init();\n    this.observeAuth();\n  }\n\n  _createClass(Fire, [{\n    key: \"off\",\n    value: function off() {\n      this.ref.off();\n    }\n  }, {\n    key: \"ref\",\n    get: function get() {\n      return firebase.database().ref('messages');\n    }\n  }, {\n    key: \"uid\",\n    get: function get() {\n      return (firebase.auth().currentUser || {}).uid;\n    }\n  }, {\n    key: \"timestamp\",\n    get: function get() {\n      return firebase.database.ServerValue.TIMESTAMP;\n    }\n  }]);\n\n  return Fire;\n}();\n\nFire.shared = new Fire();\nexport default Fire;","map":{"version":3,"sources":["/Users/ben/prj/okcai/Fire.tsx"],"names":["firebase","Fire","init","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","observeAuth","auth","onAuthStateChanged","user","signInAnonymously","message","alert","on","callback","ref","limitToLast","snapshot","parse","val","numberStamp","timestamp","text","_id","key","Date","send","messages","i","length","append","push","off","database","currentUser","uid","ServerValue","TIMESTAMP","shared"],"mappings":";;AAAA,OAAOA,QAAP,MAAqB,UAArB;;IAEMC,I;AACF,kBAAc;AAAA;;AAAA;;AAAA,SAMdC,IANc,GAMP;AAAA,aACLF,QAAQ,CAACG,aAAT,CAAuB;AACrBC,QAAAA,MAAM,EAAE,yCADa;AAErBC,QAAAA,UAAU,EAAE,+BAFS;AAGrBC,QAAAA,WAAW,EAAE,sCAHQ;AAIrBC,QAAAA,SAAS,EAAE,eAJU;AAKrBC,QAAAA,aAAa,EAAE,EALM;AAMrBC,QAAAA,iBAAiB,EAAE;AANE,OAAvB,CADK;AAAA,KANO;;AAAA,SAiBhBC,WAjBgB,GAiBF;AAAA,aACdV,QAAQ,CAACW,IAAT,GAAgBC,kBAAhB,CAAmC,KAAI,CAACA,kBAAxC,CADc;AAAA,KAjBE;;AAAA,SAoBlBA,kBApBkB,GAoBG,UAAAC,IAAI,EAAI;AAC3B,UAAI,CAACA,IAAL,EAAW;AACT,YAAI;AAEFb,UAAAA,QAAQ,CAACW,IAAT,GAAgBG,iBAAhB;AACD,SAHD,CAGE,aAAoB;AAAA,cAAXC,OAAW,QAAXA,OAAW;AACpBC,UAAAA,KAAK,CAACD,OAAD,CAAL;AACD;AACF;AACF,KA7BiB;;AAAA,SAoChBE,EApCgB,GAoCX,UAAAC,QAAQ;AAAA,aACT,KAAI,CAACC,GAAL,CACGC,WADH,CACe,EADf,EAEGH,EAFH,CAEM,aAFN,EAEqB,UAAAI,QAAQ;AAAA,eAAIH,QAAQ,CAAC,KAAI,CAACI,KAAL,CAAWD,QAAX,CAAD,CAAZ;AAAA,OAF7B,CADS;AAAA,KApCG;;AAAA,SAiDhBC,KAjDgB,GAiDR,UAAAD,QAAQ,EAAI;AAAA,0BAE6BA,QAAQ,CAACE,GAAT,EAF7B;AAAA,UAECC,WAFD,iBAEVC,SAFU;AAAA,UAEcC,IAFd,iBAEcA,IAFd;AAAA,UAEoBb,IAFpB,iBAEoBA,IAFpB;;AAAA,UAGLc,GAHK,GAGGN,QAHH,CAGVO,GAHU;AAKlB,UAAMH,SAAS,GAAG,IAAII,IAAJ,CAASL,WAAT,CAAlB;AAEA,UAAMT,OAAO,GAAG;AACdY,QAAAA,GAAG,EAAHA,GADc;AAEdF,QAAAA,SAAS,EAATA,SAFc;AAGdC,QAAAA,IAAI,EAAJA,IAHc;AAIdb,QAAAA,IAAI,EAAJA;AAJc,OAAhB;AAMD,aAAOE,OAAP;AACA,KA/De;;AAAA,SA2EhBe,IA3EgB,GA2ET,UAAAC,QAAQ,EAAI;AACjB,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,QAAQ,CAACE,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AAAA,0BACjBD,QAAQ,CAACC,CAAD,CADS;AAAA,YAChCN,IADgC,eAChCA,IADgC;AAAA,YAC1Bb,IAD0B,eAC1BA,IAD0B;AAGxC,YAAME,OAAO,GAAG;AACdW,UAAAA,IAAI,EAAJA,IADc;AAEdb,UAAAA,IAAI,EAAJA,IAFc;AAGdY,UAAAA,SAAS,EAAE,KAAI,CAACA;AAHF,SAAhB;;AAKA,QAAA,KAAI,CAACS,MAAL,CAAYnB,OAAZ;AACD;AACF,KAtFe;;AAAA,SAwFhBmB,MAxFgB,GAwFP,UAAAnB,OAAO;AAAA,aAAI,KAAI,CAACI,GAAL,CAASgB,IAAT,CAAcpB,OAAd,CAAJ;AAAA,KAxFA;;AACZ,SAAKb,IAAL;AAEF,SAAKQ,WAAL;AACC;;;;0BAsCG;AACJ,WAAKS,GAAL,CAASiB,GAAT;AACD;;;wBAZO;AACN,aAAOpC,QAAQ,CAACqC,QAAT,GAAoBlB,GAApB,CAAwB,UAAxB,CAAP;AACD;;;wBAgCO;AACN,aAAO,CAACnB,QAAQ,CAACW,IAAT,GAAgB2B,WAAhB,IAA+B,EAAhC,EAAoCC,GAA3C;AACD;;;wBAEe;AACd,aAAOvC,QAAQ,CAACqC,QAAT,CAAkBG,WAAlB,CAA8BC,SAArC;AACD;;;;;;AAqBHxC,IAAI,CAACyC,MAAL,GAAc,IAAIzC,IAAJ,EAAd;AACA,eAAeA,IAAf","sourcesContent":["import firebase from 'firebase'; \n\nclass Fire {\n    constructor() {\n      this.init();\n          // 1.\n    this.observeAuth();\n    }\n    // 2.\n    init = () =>\n      firebase.initializeApp({\n        apiKey: 'AIzaSyDLgW8QG1qO8O5WZLC1U8WaqCr5-CvEVmo',\n        authDomain: 'chatter-b85d7.firebaseapp.com',\n        databaseURL: 'https://chatter-b85d7.firebaseio.com',\n        projectId: 'chatter-b85d7',\n        storageBucket: '',\n        messagingSenderId: '861166145757',\n      });\n\n        // 2.\n  observeAuth = () =>\n  firebase.auth().onAuthStateChanged(this.onAuthStateChanged);\n// 3.\nonAuthStateChanged = user => {\n  if (!user) {\n    try {\n      // 4.\n      firebase.auth().signInAnonymously();\n    } catch ({ message }) {\n      alert(message);\n    }\n  }\n};\n\n// 1.\nget ref() {\n    return firebase.database().ref('messages');\n  }\n  // 2.\n  on = callback =>\n      this.ref\n        .limitToLast(20)\n        .on('child_added', snapshot => callback(this.parse(snapshot)));\n\n  // 4.\n  off() {\n    this.ref.off();\n  }\n\n\n\n\n  parse = snapshot => {\n    // 1.\n    const { timestamp: numberStamp, text, user } = snapshot.val();\n    const { key: _id } = snapshot;\n    // 2.\n    const timestamp = new Date(numberStamp);\n    // 3.\n    const message = {\n      _id,\n      timestamp,\n      text,\n      user,\n    };\n   return message;\n  };\n  // 1.\n  \nget uid() {\n    return (firebase.auth().currentUser || {}).uid;\n  }\n  // 2.\n  get timestamp() {\n    return firebase.database.ServerValue.TIMESTAMP;\n  }\n  \n  // 3.\n  send = messages => {\n    for (let i = 0; i < messages.length; i++) {\n      const { text, user } = messages[i];\n      // 4.\n      const message = {\n        text,\n        user,\n        timestamp: this.timestamp,\n      };\n      this.append(message);\n    }\n  };\n  // 5.\n  append = message => this.ref.push(message);\n  \n  }\n\n\nFire.shared = new Fire();\nexport default Fire;"]},"metadata":{},"sourceType":"module"}